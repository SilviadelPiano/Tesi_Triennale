% !TeX encoding = UTF-8
% !TeX program = pdflatex
% !TeX spellcheck = it_IT

\documentclass[Lau, binding=0.6cm, oneside]{sapthesis}

\usepackage{microtype}
\usepackage[italian]{babel}
\usepackage[utf8]{inputenx}

\usepackage{hyperref}
\hypersetup{pdftitle={HiSchool: sviluppo di un'applicazione per il supporto didattico per la scuola secondaria},pdfauthor={Silvia del Piano}}

% Remove in a normal thesis
\usepackage{lipsum}
\usepackage{curve2e}
\usepackage{float}
\usepackage{tabularx}
\usepackage{xcolor}
\usepackage{array}
\usepackage{colortbl}
\usepackage{booktabs, lipsum}
\usepackage{xtab}
\usepackage{longtable}
\usepackage{listings}
\usepackage{upquote}
%\usepackage{supertabular}

%\usepackage[procnames]{listings}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{grey}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\definecolor{light-gray}{gray}{0.25}\definecolor{lightgray}{rgb}{0.95, 0.95, 0.95}
\definecolor{darkgray}{rgb}{0.4, 0.4, 0.4}
%\definecolor{purple}{rgb}{0.65, 0.12, 0.82}
\definecolor{editorGray}{rgb}{0.95, 0.95, 0.95}
\definecolor{editorOcher}{rgb}{1, 0.5, 0} % #FF7F00 -> rgb(239, 169, 0)
\definecolor{editorGreen}{rgb}{0, 0.5, 0} % #007C00 -> rgb(0, 124, 0)
\definecolor{orange}{rgb}{1,0.45,0.13}		
\definecolor{olive}{rgb}{0.17,0.59,0.20}
\definecolor{brown}{rgb}{0.69,0.31,0.31}
\definecolor{purple}{rgb}{0.38,0.18,0.81}
\definecolor{lightblue}{rgb}{0.1,0.57,0.7}
\definecolor{lightred}{rgb}{1,0.4,0.5}

\lstdefinestyle{Ruby} {
	aboveskip=3mm,
	belowskip=3mm,
	showstringspaces=false,
	columns=flexible,
	basicstyle={\footnotesize\ttfamily},
	numberstyle={\tiny},
	numbers=left,
	keywordstyle=\color{blue},
	commentstyle=\color{dkgreen},
	stringstyle=\color{mauve},
	breaklines=true,
	breakatwhitespace=true,
	tabsize=2,
	sensitive=true,
	morestring=*[d]{"},
	morestring=[s][]{\#\{}{\}},
	%procnamekeyes={def},
	%procnamestyle=\color{red},
}

% CSS
\lstdefinelanguage{CSS}{
  keywords={color,background-image:,margin,padding,font,weight,display,position,top,left,right,bottom,list,style,border,size,white,space,min,width:, transition:, transform:, transition-property, transition-duration, transition-timing-function, overflow:, height:, max, margin:, padding:, background, color:, top:, left:, bottom:, size:},	
  sensitive=true,
  morecomment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]',
  morestring=[b]",
  alsoletter={:},
  alsodigit={-}
}

%HAML
\lstdefinelanguage{HAML}{
	keywords={\%html, \%meta, \%title, \%body, csrf_meta_tags, stylesheet_link_tag, javascript_include_tag, \#main-container, .nav.navbar-default.navbar-fixed-top, .container, .navbar-header, image_tag, \%ul.nav.navbar-nav.navbar-right, yield, .container-fluid, .row, .col-xs-12.col-md-4.center-block, .nav.navbar-default.navbar-fixed-bottom, \%ul.nav.navbar-nav.navbar-left},
	sensitive=true,
	morestring=[b]',
  	morestring=[b]"
}

\lstdefinestyle{CSS} {
% General design
%  backgroundcolor=\color{editorGray},
  basicstyle={\footnotesize\ttfamily},   
  frame=b,
  % line-numbers
  xleftmargin={0.75cm},
  numbers=left,
  stepnumber=1,
  firstnumber=1,
  numberfirstline=true,	
  % Code design
  keywordstyle=\color{blue}\bfseries,
  ndkeywordstyle=\color{editorGreen}\bfseries,
  stringstyle=\color{editorOcher}\ttfamily,
  commentstyle=\color{olive}\ttfamily,
  % Code
  alsodigit={.:;},	
  tabsize=2,
  showtabs=false,
  showspaces=false,
  showstringspaces=false,
  extendedchars=true,
  breaklines=true,
}

\lstset{language=Ruby, , captionpos=b, frame=single}

\lstset{literate=
  {á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ú}{{\'u}}1
  {Á}{{\'A}}1 {É}{{\'E}}1 {Í}{{\'I}}1 {Ó}{{\'O}}1 {Ú}{{\'U}}1
  {à}{{\`a}}1 {è}{{\`e}}1 {ì}{{\`i}}1 {ò}{{\`o}}1 {ù}{{\`u}}1
  {À}{{\`A}}1 {È}{{\'E}}1 {Ì}{{\`I}}1 {Ò}{{\`O}}1 {Ù}{{\`U}}1
  {ä}{{\"a}}1 {ë}{{\"e}}1 {ï}{{\"i}}1 {ö}{{\"o}}1 {ü}{{\"u}}1
  {Ä}{{\"A}}1 {Ë}{{\"E}}1 {Ï}{{\"I}}1 {Ö}{{\"O}}1 {Ü}{{\"U}}1
  {â}{{\^a}}1 {ê}{{\^e}}1 {î}{{\^i}}1 {ô}{{\^o}}1 {û}{{\^u}}1
  {Â}{{\^A}}1 {Ê}{{\^E}}1 {Î}{{\^I}}1 {Ô}{{\^O}}1 {Û}{{\^U}}1
  {Ã}{{\~A}}1 {ã}{{\~a}}1 {Õ}{{\~O}}1 {õ}{{\~o}}1
  {œ}{{\oe}}1 {Œ}{{\OE}}1 {æ}{{\ae}}1 {Æ}{{\AE}}1 {ß}{{\ss}}1
  {ű}{{\H{u}}}1 {Ű}{{\H{U}}}1 {ő}{{\H{o}}}1 {Ő}{{\H{O}}}1
  {ç}{{\c c}}1 {Ç}{{\c C}}1 {ø}{{\o}}1 {å}{{\r a}}1 {Å}{{\r A}}1
  {€}{{\euro}}1 {£}{{\pounds}}1 {«}{{\guillemotleft}}1
  {»}{{\guillemotright}}1 {ñ}{{\~n}}1 {Ñ}{{\~N}}1 {¿}{{?`}}1
}

\definecolor{gray}{gray}{0.4}
\newcommand{\bs}{\textbackslash}

% titlepage commands

\title{HiSchool: sviluppo di un'applicazione per il supporto didattico per la scuola secondaria}
\author{Silvia del Piano}
\IDnumber{1759992}
\course{Ingegneria Informatica e Automatica}
\courseorganizer{Facoltà di Ingegneria dell'Informazione, Informatica e Statistica}
\AcademicYear{2018/2019}
\copyyear{2019}
\advisor{Prof. Roberto Beraldi}
\authoremail{delpiano.1759992@studenti.uniroma1.it}

\versiondate{today}

\begin{document}

\frontmatter

\maketitle

\dedication{Da vedere}

\tableofcontents

\mainmatter

\chapter{Raccolta dei requisiti}

\section{Descrizione della realtà di interesse}

Un giorno parlando con i miei colleghi universitari, si è accennato alla comodità offerta dai siti relativi ai singoli corsi di studio. Essi infatti sono un porto sicuro per ogni studente iscritto, frequentante e non: è possibile trovarvi il materiale su cui studiare, informazioni e contatti dei professori a cui sono affidate le lezioni, loro comunicazioni e spesso molto altro. Tutti sanno che per qualsiasi dubbio possa sorgere a proposito di uno specifico corso il primo posto dove andare a guardare è il sito ad esso dedicato. Tutto ciò mi ha invogliato a realizzare qualcosa di simile per la scuola secondaria: una piattaforma che i prinicipali attori coinvolti (studenti, insegnanti e genitori) possano usare per facilitare la formazione dei ragazzi ed il suo monitoraggio.\\
I servizi fondamentali per la didattica offerti sono i seguenti:
\begin{itemize}
	\item Possibilità di visionare e gestire (per gli insegnanti) il materiale didattico.
	\item Avere sempre a portata di mano i corsi frequentati/insegnati e le informazioni sui relativi docenti.
	\item Ricevere/dare (per gli insegnanti) cominicazioni tramite post alle classi di interesse per gli utenti (le quali saranno la classe frequentata per l'alunno, la classe di cui fa parte il figlio per il genitore, e le classi affidate all'insegnante).
	\item Avere a disposizione un calendario dove saranno presenti le comunicazioni importanti (secondo quanto specificato al momento della loro pubblicazione).
\end{itemize}

In quanto pensata per affiancarsi alle piattaforme già esistenti per la scuola, nell'applicazione vengono memorizzati i dati anagrafici degli utenti, in modo che in futuro i servizi offerti possano essere integrati o usati parallelamente a quelli istituzionali già presenti. Sempre in quest'ottica, gli unici che possono inserire una scuola con le relative classi nel database dell'applicazione sono gli sviluppatori.\\

\section{Dati gestiti dal sistema e principali funzionalità} \label{requisiti_db}

Essa prevede tre tipi di utenti: gli studenti (Student), gli insegnanti (Teacher) e i genitori (Parent). Di ogni utente sono memorizzati in un database il nome, il cognome, il codice fiscale, la data e il luogo di nascita, il sesso, la scuola (tra quelle registrate sulla piattaforma dagli sviluppatori), la classe (tra quelle registrate per ciascuna scuola), il ruolo (tra Studente, Insegnante e Genitore). Saranno memorizzati anche una mail e una password con cui si potrà effettuare il login al sito, e nel caso del Genitore, anche il nome e il cognome del figlio iscritto alla scuola. Ad ogni modo, per agevolare l’accesso alla piattaforma sarà fornito anche il servizio di autenticazione tramite Google. Ogni utente ha una propria Dashboard da dove, a seconda del ruolo, può usufruire di diverse funzionalità. Tutti gli utenti possono vedere le informazioni fondamentali associate al proprio account, il calendario e i post contenenti comunicazioni relative alla classe di interesse pubblicate dagli insegnanti; le communicazioni possono avere associata anche una scadenza che verrà mostrata sul calendario. I post saranno memorizzati nell’applicazione. Lo Studente può navigare nell’applicazione per consultare le singole pagine relative alle materie studiate, dove è caricato il materiale di cui può fare il download. L’Insegnante può creare i post e cancellare, fare il download e l’upload delle risorse relative alla materia che insegna.\\
Per semplicità nell’implementazione si assume che ogni Insegnante abbia affidata una sola materia, che ogni Genitore possa avere solo un figlio iscritto alla scuola, che ogni materia sia spiegata da un solo Insegnante e che abbia senso definire una scuola senza classi; tutto ciò considerando la classe frequentata dall’alunno. Tuttavia, lo schema del database è pensato per una maggiore scalabilità, e il codice l'applicazione è stato scritto in modo che essa sia facilmente modificabile o ampliabile. \\
Tutti i file che costituiscono risorse per gli Studenti sono conservati sul Google Drive associato all’account dell’applicazione.\\

\subsection{MockUp e User Stories}

Le funzionalità e l'aspetto che l'applicazione deve avere sono meglio specificate rispettivamente nelle user stories e nei lo-fi mockup.\\
Questi due strumenti sono fondamentali nella fase di raccolta dei requisiti e progettazione: fungono da ponte tra il team che si occuperà di relizzare il software e i committenti, così che le aspettative di questi ultimi siano pienamente soddisfatte. Essi infatti sono abbastanza generici in modo che chiunque possa comprenderli, ma allo stesso tempo sono sufficientemente specifici da poter essere implementati dagli sviuppatori.

\newpage
\subsection{Lo-Fi MockUp}

Di seguito i lo-fi mockup, realizzati con carta e penna, rapprensentano ciò che l'utente vedrà sulla piattaforma e come potrà navigarla.\\

\begin{figure}[H]
	\centering
	\includegraphics[width=1.3\linewidth, angle=-90]{images/mockup_1}
	\caption{Lo-Fi-Mockup 1}
	\label{fig:mockup_1}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=1.3\linewidth, angle=-90]{images/mockup_2}
	\caption{Lo-Fi-Mockup 2}
	\label{fig:mockup_2}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=1.3\linewidth, angle=-90]{images/mockup_3}
	\caption{Lo-Fi-Mockup 3}
	\label{fig:mockup_3}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/mockup_4}
	\caption{Lo-Fi-Mockup 4}
	\label{fig:mockup_4}
\end{figure}

\subsection{User Stories}
Di seguito si riporta l'elenco delle user stories: descrivono brevemente ma in maniera efficace le azioni che verranno implementate fornendo i servizi precedentemente descritti agli utenti.\\

\begin{enumerate}
	\item \textbf{Go to the "SignUp" page from the "Home" page}\\
			As a user\\
			So that I can sign up\\
			Given I'm in the "Home" page\\
			When I press the button "SignUp"\\
			Then I should be in the "SignUp" page\\
	\item \textbf{SignUpAs a user}\\
			So that I can use the app's services\\
			Given I'm in the "SignUp" page\\
			When I fill the form correctly\\
			and I press the button "SignUp"\\
			Then I should be registered in the app\\
			and I should be in the "Home" page\\
	\item \textbf{Return to the "Home" page from the "SignUp" page}\\
			As a user\\
			So that I can return to the "Home" page without signing up\\
			Given I’m in the "SignUp" page\\
			When I press the button "Home"\\
			Then I should be in the "Home" page\\
	\item \textbf{Go to the "LogIn" page from the "Home" page}\\
			As a user\\
			So that I can login\\
			Given I’m in the "Home" page\\
			When I press the button "Login"\\
			Then I should be in the "Login" page\\
	\item \textbf{LogIn without Google}\\
			As a user\\
			So that I can use the app’s services\\
			Given I’m in the "LogIn" page\\
			and that I’ve signed up\\
			When I fill the form correctly\\
			and I press the button "Login"\\
			Then I should be logged in and I should be in the correct "Dashboard\_*" page\\
	\item \textbf{LogIn with Google}\\
			As a user\\
			So that I can use the app’s services\\
			Given I’ve signed up\\
			I want to log in with Google OAuth\\
	\item \textbf{Go to the "Home" page from the "LogIn" page}\\
			As a user\\
			So that I can return to the "Home" page without logging in\\
			Given I’m in the "LogIn" page\\
			When I press the button "Home"\\
			Then I should be in the "Home" page\\
	\item \textbf{LogOut}\\
			As a user\\
			So that I can stop using the app’s services\\
			Given I’m in the correct "Dashboard\_*" page\\
			When I press the button "LogOut"\\
			Then I should have logged out correctly\\
			and I should be in the "Home" page\\
	\item \textbf{Calendar}\\
			As a user\\
			So that I can know the current date and organize my work properly\\
			Given I’m in the correct "Dashboard\_*" page\\
			Then I should see the current date\\
	\item \textbf{Posts seen by "Student" as a "Student"}\\
			As a "Student"\\
			So that I can see the posts all my "Teacher"s made\\
			Given I’m on the "Dashboard\_s" page\\
			Then I should see the 10 most recent posts\\
	\item \textbf{Go to the "Dashboard\_*" page}\\
			As a user\\
			So that I can go to the "Dashboard\_*" whenever I need it\\
			When I press the button "Dashboard"\\
			Then I should be in the correct "Dashboard\_*" page\\
	\item \textbf{Materie}\\
			As a "Student"\\
			So that I can see the subjects teached at school\\
			Given I’m on the "Dashboard\_s" page\\
			When I press the button "Materie"\\
			Then I should be on the "Materie" page\\
	\item \textbf{Subject info}\\
			As a "Student"\\
			So that I can have more information about a subject\\
			Given I’m in the "Materie" page\\
			When I click che link corresponding to subject *\\
			Then I should be in the page "Materia*" corresponding to subject *\\
	\item \textbf{Go to the "Materie" page from "Materia*" page}\\
			As a "Student"\\
			So that I can go to the "Materie" page from the "Materia*" page\\
			Given I’m in the "Materia*" page\\
			When I press the button "Materie"\\
			Then I should be in the "Materie" page\\
	\item \textbf{Resources for a specific subject}\\
			As a "Student"\\
			So that I can use the resources on subject*\\
			Given I’m in the "Materia*" page\\
			and I see the files that are the resources\\
			When I click the link corresponding to a file\\
			Then I should be able to download that file\\
	\item \textbf{"Teacher"’s posts}\\
			As a "Student"\\
			So that I can have a focus on the specific subject*\\
			Given I’m in the "Materia*" page\\
			Then I should see the 5 most recent posts made by the "Teacher" corresponding to that subject\\
	\item \textbf{Posts seen by "Teacher"}\\
			As a "Teacher"\\
			So that I can see the workload my "Student"s have\\
			Given I’m in the "Dahsboard\_t" page\\
			Then I should see the 10 most recent posts made by me and the other "Teacher"s who teach my "Student"s\\
	\item \textbf{Remove a file}\\
			As a "Teacher"\\
			So that I can remove files\\
			Given I’m in the "Dashboard\_t" page\\
			When I click on the “Cancella” link corresponding to the file I want to remove\\
			Then the file corresponding to the link I clicked should be removed\\
	\item \textbf{Download a file}\\
			As a "Teacher"\\
			So that I can download files\\
			Given I’m in the "Dashboard\_t" page\\
			When I click on the “Download” link corresponding to the file I want to download\\
			Then the file corresponding to the link I clicked should be downloaded\\
	\item \textbf{Upload a file}\\
			As a user\\
			So that I can upload a file\\
			Given I’m in the "CaricoFile" page\\
			And that I’ve specified what file I want to upload\\
			When I press the button "Aggiungi"\\
			Then the file should be uploaded correctly\\
	\item \textbf{Go to the "NewPost" page from the "Dashboard\_t" page}\\
			As a "Teacher"\\
			So that I can communticate with my "Student"s and assign homework to them\\
			Given I’m in the "Dashboard\_t" page\\
			When I press the button "Nuovo Post"\\
			Then I should be in the "NewPost" page\\
	\item \textbf{Publish a post}\\
			As a "Teacher"\\
			So that I can communicate with my "Student"s and assign homework to them\\
			Given I’m in the "NewPost" page\\
			and that I filled the form correctly\\
			When I press the button "Pubblica"\\
			Then a new post should be published correctly\\
	\item \textbf{Posts seen by a "Parent"}\\
			As a "Parent"\\
			So that I can be updated on my son’s scholastic situation\\
			Given I’m in the "Dashboard\_p" page\\
			Then I should see the posts made by my son’s "Teacher"s\\
\end{enumerate}

\chapter{Tecnologie e Metodologie utilizzate}

\section{Rails e il paradigma Model-View-Controller} \label{mvc}

L’applicazione è stata realizzata con Ruby on Rails, seguendo i principi su cui esso è basato, e varie gemme in esso contenuto.\\
In particolare, Rails è un framework per lo sviluppo di applicazioni web SaaS (Software as a Service) scritto in Ruby, ed è stato sviluppato tenendo a mente le più importanti linee guida nella progettazione e programmazione di questo tipo di software. Due dei principi fondamentali sono: Don’t Repeat Yourself (non ci deve essere codice ridondante, ma una singola scrittura efficace delle varie funzionalità e caratteristiche) e Conventions Over Configuratons (bisogna specificare delle configurazioni solo nel caso in cui non si seguano quelle raccomandate naturalmente dal framework).
Tutto ciò è implementato col paradigma Model-View-Controller: i modelli servono per interagire con i dati del sistema, le view li visualizzano in maniera appropriata rendendo possibile l’interazione con gli utenti, mentre i controller ricevono i comandi di questi (solitamente attraverso le view e il browser) e li eseguono.

\subsection{Autenticazione locale}

Per i processi di autenticazione e autorizzazione è stata utilizzata la gemma Canard, per implementare un modello di Role-Based Access Control, insieme alla gemma Devise.
Devise è uno strumento molto utile per ogni svilippatore Rails: è organizzata in moduli, per cui è possibile costruire dal più semplice meccanismo di identificazione e verfica, a quello più complesso con diversi servizi aggiuntivi. In questa applicazione sono stati usati soprattutto i seguenti moduli:

\begin{itemize}
	\item \textbf{Database Authenticatable}: memorizza in maniera sicura e cifrata (grazie al supporto della gemma Bcrypt) la password dell’utente nel database del sistema
	\item \textbf{Registarable}: permette agli utenti di registrarsi
	\item \textbf{Rememberable}: gestisce le sessioni degli utenti tramite i cookie
	\item \textbf{Validatable}: convalida le email e le password
	\item \textbf{Omniauthable}: gestisce autenticazione tramite OAuth (ulteriori dettagli nella sezione successiva).
\end{itemize}

Ulteriori comodità di questa gemma sono le route e le view da essa create automaticamente per tutti i processi relativi all’autenticazione, personalizzabili in maniera opportuna

\subsection{Autenticazione tramite Google OAuth}

OAuth è un protocollo di rete basato su HTTP che consente di delegare l’autenticazione ad una terza entità (quale potrebbe essere Google, Facebook, Twitter...). In esso sono definiti quattro ruoli principali:

\begin{enumerate}
	\item \textbf{Utente} (Resource Owner): è il possessore dell’account, e deve autorizzare l’accesso alle informazioni contenute in esso e alle risorse protette conservate nel Resource Server
	\item \textbf{Client} (Consumer): è l’applicazione che vorrebbe accedere alle informazioni e risorse dell’Utente, di cui chiede l’autorizzazione
	\item \textbf{Resource Server}: il server dove si trovano le risorse protette dell’Utente
	\item \textbf{Authorization Server}: è il server che si occupa di richiedere all’Utente di autenticarsi per autorizzare l’accesso alle sue risorse
\end{enumerate}

Lo schema di funzionamento è descritto dalla seguente immagine:\\

\begin{figure}[H]
	\centering
	\includegraphics[width=0.90\linewidth]{images/oauth}
	\caption{OAuth Flow}
	\label{fig:oauth}
\end{figure}

In questo caso, l’Authorization Server e il Resource Server coincidono (Google), mentre il ruolo del client è svolto dalla nostra applicazione.\\
Per implementare tutto ciò ci si è serviti, come accennato in precedenza, del modulo Omniauthable di Devise in aggiunta alla gemma \textit{omniauth-googleoauth2}.

\subsection{Google Drive}

Per memorizzare le risorse a disposizione degli studenti si è usato Google Drive.\\
La prima cosa da fare è stato associare all'applicazione un service account dalla Google API Console. Un service account è un particolare account Google che rappresenta un' entità non umana che necessita di accedere a delle risorse protette. Di conseguenza all'applicazione in esame sono stati associate una email, una password e un ID per Google.\\
Per gestire i file (upload, download) ed interagire con questo servizio è stata usata la gemma \textit{google-api-client}.

\subsection{Altre gemme}

Per una più completa trattazione dello sviluppo si è cominciato ad impostare il deploy su Heroku, tramite le gemme \textit{rails\_12factor} (per configurare l'ambiente di produzione dell'applicazione), \textit{pg} (in quanto il database di Heroku è basato su PostgreSQL e non su SQLite, usato durante lo sviluppo) e \textit{figaro} (per gestire le chiavi e gli ID segreti negli ambienti di sviluppo e produzione).\\
Per realizzare il calendario nella Dashboard degli utenti si è usata \textit{simple\_calendar}, mentre per fare i diagrammi UML deli controller e dei model si è utilizzata \textit{railroady}.\\
Di seguito è riportato il \textit{Gemfile} con tutte le gemme utilizzate:\\


\lstinputlisting[style=Ruby, caption=Gemfile, label=lst:gemfile]{code/Gemfile}
Una discussione degli strumenti usati per i test si può trovare nella sezione \ref{test}.\\

\section{Agile per lo sviluppo software} \label{agile}

Nel realizzare questa applicazione mi sono ispirata alla metodologia Agile. Essa è in realtà pensata per gruppi di persone che lavorano insieme allo stesso software: le interazione tra i vari membri di un singolo team e tra i responsabili di questi hanno un'enorme importanza, e sono il vero punto di forza di questa metodologia, insieme al contatto con il committente.\\
Nonostante ciò, in questo lavoro ho voluto tenere fede ai principi di Behavior-Driven Design e Test-Driven Development. Di conseguenza, prima dello sviluppo del codice, nella fase di progettazione, sono stati realizzati i lo-fi mockup e le user stories per fare chiarezza su cosa doveva essere realizzato. Successivamente, durante lo sviluppo, per ogni user story veniva scritto un test e il codice per soddisfarlo, in modo che tutto fosse fatto in modo corretto. Ponendo l'attenzione sulla qualità e sui contenuti da subito si sono evitati lunghi e tortuosi processi di debug, oltre all'implementazione di funzionalità inutili o non richieste.

\subsection{Tool per applicare al meglio Agile}

Per applicare al meglio la metologia Agile e lavorare efficientemente ho utilizzato i seguenti strumenti:

\begin{itemize}
	\item \textbf{Git}: per il versioning control. La repository su cui è conservato il progetto è la seguente: \url{https://github.com/SilviadelPiano/HiSchool.git}
	\item \textbf{Visual Studio Code} come editor
	\item \textbf{Draw.io} per la reailzzazione degli schemi ER e UML
	\item \textbf{Pivotal Tracker} per il tracking degli sprint e per monitorare i progressi e l'andamento del lavoro. Il link alla pagina corrispondente all'applicazione in esame è il seguente: \url{https://www.pivotaltracker.com/n/projects/2393952}
\end{itemize}

\chapter{Analisi Concettuale del Sistema}

\section{Schema Entità-Relazione}
In questa sezione viene riportato lo schema ER del databse. Come si può vedere esso rappresenta i requisiti descritti nella sezione \ref{requisiti_db}, assieme ad altri vincoli necessari per lo sviluppo di questa applicazione.
Sono indicati anche gli identificatori principali.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/db_HiSchool.png} 
	\caption{Schema ER}
	\label{fig:schema_ER}
\end{figure}

\section{Elenco delle entità e delle relazioni}

In questa sezione verranno presentate in maniera più approfondita le varie entità e relazioni situate nello schema.
\subsection{Generalizzazione User}
\textbf{User} è l'entità che rappresenta l'utente che andrà ad usufruire dell'applicazione: si può notare infatti la generalizzazione che differenzia i tre tipi di utilizzatori che si avranno.\\
\textbf{Parent} e \textbf{Student}, cioè le entità che rappresentano il genitore e lo studente, sono legate dalla relazione \textbf{ChildOf}: essa esprime la parentela tra lo studente iscritto e il genitore (potrebbe essere anche il tutore legale del ragazzo in mancanza di parenti più stretti) dello stesso. Un Parent per registrarsi sulla piattaforma deve avere almeno un figlio Student registrato su di essa. D'altro canto, uno Student non deve per forza avere un Parent ad esso associato per registrarsi, ma può averne al massimo 2 associati ad esso.\\
Durante la ristrutturazione Parent, Student e Teacher sono state accorpate a User per generare un'unica entità omonima, dove i vari ruoli sono distinti da una bitmask, tramite l'ausilio della gemma Canard.

\subsection{Entità School e Class}
L'entità \textbf{School} rappresenta la scuola registrata nel database dell'applicazione, ed è legata a \textbf{Class} tramite la relazione \textbf{Has}. Class è infatti identificata dal proprio nome e dalla Scuola a cui appartiene. Per esempio, la classe 1\ap{a} del liceo scientifico sarà presente in tutti i licei scientifici, ed almeno in 1, altrimenti non esisterebbe, da qui l'associazione 1...n. Una Scuola deve avere almeno una classe.\\
La relazione \textbf{Teaches} esprime l'incarico di insegnamento conferito ad un \textbf{Teacher} (insegnante) nei confronti della classe, ed è presente anche la materia (Subject) oggetto di lezione. Ogni classe può essere presa in carico da diversi insegnanti, ma ne deve avere almeno 1 (si pensi solo alle varie materie presenti in  un liceo), ed un singolo insegnante, per essere tale, deve fare lezione ad almeno un classe, ma può averne affidate più di una.\\
La relazione \textbf{MemberOf} invece esprime il fatto che ogni classe debba essere frequentata da almeno uno studente, e questo per essere tale deve, e può, essere iscritto ad una sola classe.\\
Nella ristruttrazione Class e Has sono state accorpate per generare un'unica entità che tenga traccia del nome della classe e della scuola ad essa associata. School rimane indipendente, in modo che nel futuro sia possibile associare ad essa più classi. Inoltre, al momento della registrazione
all'utente viene chiesto di specificare una classe ed una scuola (con diverse form da compilare a seconda del ruolo), e sono effettuati due controlli: si verifica l'esistenza della singola scuola (School) nel database, e poi si verfica che per questa sia registrata la classe dichiarata nel form tramite l'entità appena creata con l'accorpamento. Quest'ultima è utile anche per motivi di efficienza del codice.

\subsection{Entità Post}
L'entità \textbf{Post} rappresenta le comunicazioni che possono essere fatte sulla piattaforma. Ogni Post deve essere creato da un singolo insegnante secondo quanto espresso dalla relazione \textbf{MadeBy}, mentre un insegnante non ha l'obbligo di creare Post, e non c'è limite a quanti ne può fare. L'attributo PublishDate registra la data della pubblicazione.
Da notare gli attributi facoltativi Link e Deadline. Essi sono stati inseriti per fornire maggiori opzioni al fine di rendere più efficaci le comunicazioni: come insegnante vorrei poter mettere in evidenza un link dove trovare materiale utile oppure una scadenza o una data importante relativa alla comunicazione appena publicata (che sarà segnata sul calendario).\\
Un Post deve essere associato ad almeno una classe, secondo quanto indicato dalla relazione \textbf{For}, in modo che i suoi membri possano vederlo.

\chapter{Progettazione del sistema}

Questa applicazione è basata su tre layer principali: il Data Layer, l'Application Layer e il Presentation Layer. Di seguito sono esposti gli schemi architetturali per una maggiore comprensione del sistema.

\section{Archittura del sistema}

\subsection{Architettura dei Controller}

In questa sezione è riportato lo schema UML dei controller. (Figura \ref{fig:schema_UML_controllers}).\\

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/controllers_UML} 
	\caption{Schema UML Controllers}
	\label{fig:schema_UML_controllers}
\end{figure}

\subsection{Architettura dei Model}

In questa sezione invece è riportato lo schema UML dei model. (Figura \ref{fig:schema_UML_models}).\\

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/models_UML} 
	\caption{Schema UML Models}
	\label{fig:schema_UML_models}
\end{figure}

\subsection{Architettura delle View}

In questa sezione infine è possibile visionare il diagramma UML relativo alle views. (Figura \ref{fig:UML_views}).

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/UML_views} 
	\caption{Schema UML Views}
	\label{fig:UML_views}
\end{figure}

\section{Progettazione logica del Data Layer}

Come spiegato nella sezione \ref{mvc} Rails è basato sul paradigma Model-View-Controller, quindi nel Data-Layer sono conservati i dati che verranno usati dalle altre componenti delll'applicazione. Tutto ciò è possibile, nell'ambiente di sviluppo, grazie alla gemma \textit{sqlite3}.\\
Rails offre al programmatore un buon livello di automatizzazione di diversi compiti, tra cui la creazione e la modifica del database: lo schema è conservato nel file \textit{app/db/schema.rb}, il quale viene modificato tramite altri file detti migration, raccolti nella cartella \textit{app/db/migrate}.
In questo modo la probabilità di commettere errori umani (distrazione, battitura, ecc.) è minimizzata e si aumenta l'efficienza del lavoro.
Di seguito il file \textit{app/db/schema.rb}:

\lstinputlisting[style=Ruby, caption=app/db/schema.rb, label=lst:dbschema]{code/schema.rb}

Da notare gli attributi \textit{index}: essi indicano delle foreign key, cioè riferimenti ad altre tabelle.

\chapter{Realizzazione del sistema}

\section{Application Layer}

Nell' Application Layer risiede la logica dell'applicazione, implementata attraverso i controller. In particolare, le configurazioni principali sono definite nel file \textit{app/controllers/application\_controller.rb} (listing \ref{lst:app_controller}), che contiene il codice dell'Application Controller. Esso è lo scheletro su cui poggia tutta la struttura, e le caratteristiche qui definite saranno ereditate da tutti gli altri controller.\\
In generale, i controller si occupano di processare le chiamate fatte dal browser verso l'applicazione, usando i dati contenuti nel Data Layer, esposti dai model, e presentandoli attraverso le view. Grazie al file \textit{config/routes.rb}, le richieste HTTP sono mappate nei correspondenti metodi definiti nei controller. Nella seguente tabella sono elencate le principali routes dell'applicazione. 

\begin{center}
	\begin{longtable}[H]{p{0.15\textwidth}p{0.2\textwidth}p{0.3\textwidth}p{0.25\textwidth}}
		\toprule
		\textbf{Metodo HTTP} & \textbf{URI Pattern} & \textbf{Controller\#Action} & \textbf{Effetto} \\
		\midrule
		\rowcolor[gray]{0.9}
		GET & /users/sign\_in (.:format) & devise/sessions\#new & Restituisce la pagina con la form per il login \\
		\midrule
		POST & /users/sign\_in (.:format) & devise/sessions\#create & Dopo aver registrato o loggato l'utente restituisce la pagina di default per esso \\
		\midrule
		\rowcolor[gray]{0.9}
		GET|POST & /users/auth /google\_oauth2 (.:format) & omniauth\_callbacks \#passthru & Restituisce la pagina relativa a OAuth di Google \\
		\midrule
		GET|POST & /users/auth /google\_oauth2 /callback (.:format) & omniauth\_callbacks \#google\_oauth2 & Una volta completato il login restituisce la dashboard relatica all'utente \\
		\midrule
		\rowcolor[gray]{0.9}
		GET & /users/sign\_up (.:format) & registrations\#new & Restituisce la pagina di registrazione dell'utente \\
		\midrule
		POST & /users(.:format) & registrations\#create & Registra l'utente nel database e reindirizza sulla pagina contenente la seconda form per complatare la registrazione\\
		\midrule
		\rowcolor[gray]{0.9}
		GET & /home/index (.:format) & home\#index & Restituisce la pagina iniziale dell'applicazione \\
		\midrule 
		GET & /home /school\_class\_new (.:format) & home\#school\_class\_new & Restituisce la seconda form per completare la registrazione \\
		\midrule
		\rowcolor[gray]{0.9}
		POST & /home /school\_class\_new (.:format) & home\#create & Registra la classe e la scuola di interesse per l'utente e lo reindirizza sulla sua dashboard se la registrazione è andata a buon fine.\\
		\midrule 
		GET & /dashboard (.:format) & dashboard\#get & Restituisce la dashboard dell'utente loggato\\
		\midrule
		\rowcolor[gray]{0.9}
		GET & /dashboard /delete\_file (.:format) & dashboard\#delete\_file & Cancella il file il cui link è stato selezionato\\
		\midrule
		GET & /dashboard /download\_file (.:format) & dashboard\#download\_file & Fa il download del file il cui link è stato selezionato\\
		\midrule
		\rowcolor[gray]{0.9}
		POST & /dashboard (.:format) & dashboard\#upload\_file & Fa l'upload del file il cui link è stato selezionato\\
		\midrule
		GET & /subjects(.:format) & subjects\#index & Restituisce la pagina dove sono mostrate le materie di interesse \\
		\midrule 
		GET & /subjects/:id (.:format) & subjects\#show & Restituisce la pagina relativa alla singola materia il cui link è stato selezionato \\
		\midrule
		\rowcolor[gray]{0.9}
		GET & /subjects/:id /download\_file (.:format) & subjects\#view\_file & Fa il download del file il cui link è stato selezionato dalla pagina di una singola materia \\
		\midrule 
		POST & /posts(.:format) & posts\#create & Crea un nuovo post e reindirizza l'utente sulla dashboad\\
		\midrule 
		GET & /posts/new (.:format) & posts\#new & Restituisce la pagina con la form per creare un nuovo post\\
		\midrule
		\rowcolor[gray]{0.9}
		GET & / & home\#index & Definisce la pagina iniziale dell'applicazione come root \\
		\bottomrule
	\end{longtable}
\end{center}

Nel listing \ref{lst:dashboard_controller} è mostrato anche il file \textit{app/controllers/dashboard\_controller.rb}, l'altro principale controller su cui si basa l'applicazione.\\ 

\lstinputlisting[style=Ruby, caption=app/controllers/application\_controller.rb, label=lst:app_controller]{code/application_controller.rb}

Si noti il codice necessario per far funzionare correttamente Devise, i servizi Google Drive e il protocollo OAuth.\\

\lstinputlisting[style=Ruby, caption=app/controllers/dashboard\_controller.rb, label=lst:dashboard_controller]{code/dashboard_controller.rb}

Nel Dashboard controller è invece possibile vedere il codice che si occupa di processare i principali contenuti della dashboard: come prima cosa si controlla che l'utente si sia autenticato, altrimenti viene rimandato alla pagina di login. Successivamente si recuperano le principali informazioni su di esso, sui file e sui post.

\section{Presentation Layer}

Il Presentation Layer è costituito dall'insieme delle view che vengono presentate all'utente. Esse sono state realizzate mediante il linguaggio HAML, e si trovano nella cartella \textit{app/views}. Per lo styling sono stati usati i file SCSS definiti nella cartella \textit{app/assets/stylesheets}, assieme alla gemma \textit{bootstrap} per l'utilizzo dell'omonima libreria. Nella cartella \textit{app/assets/images} si trovano le immagini rese nel browser (in questo caso il logo HiSchool).\\
Nel rispetto del principio Don't Repeat Yoursel, sono stati creati i file \textit{app/views/layouts/application.html.haml} (Listing \ref{lst:application_layout}) e \textit{app/assets/stylesheets/application.css.scss} (Listing \ref{lst:application_css}), che essendo ereditati dall'intera applicazione forniscono lo styling di base generale.\\
Inoltre si è fatto spesso uso di partials.

\lstset{language=HAML, , captionpos=b, frame=single}
\lstinputlisting[language=HAML, style=CSS, caption=app/views/layouts/application.html.haml, label=lst:application_layout]{code/application.html.haml}

\lstset{language=CSS, , captionpos=b, frame=single}
\lstinputlisting[language=CSS, style=CSS, caption=app/assets/stylesheets/application.css.scss, label=lst:application_css]{code/application.css.scss}

\subsection{Aspetto dell'applicazione}
In questa sezione verranno presentate le view dell'applicazione, le dimensioni sono state riadattate per una migliore impaginazione. Nella figura \ref{fig:home_page} si può vedere la schermata che accoglie l'utente avviata la piattaforma:

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/home_page} 
	\caption{app/views/home/index.html.haml}
	\label{fig:home_page}
\end{figure}

Una volta premuto il bottone \textbf{Registrati} ci si ritrova nella pagina di registrazione, mostrata nella figura \ref{fig:registration_page}.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/registration_page} 
	\caption{app/views/home/registrations/new.html.haml}
	\label{fig:registration_page}
\end{figure}

A seconda del ruolo selezionato, se tutti i campi della form sono stati compilati correttamente, premendo il bottone \textbf{Registrati} si arriva a pagine dall'aspetto diverso. Esse sono però definite tutte nello stesso file di codice: \textit{app/views/home/school\_class\_new.html.haml}. 
Se viene selezionato il ruolo di \textit{Genitore} si arriverà alla pagina in figura \ref{fig:school_p_form}, se si è selezionato \textit{Studente}      a quella in figura \ref{fig:school_s_form}, e infine se si è selezionato \textit{Insegnante} ci si ritroverà una schermata come quella in figura \ref{fig:school_t_form}.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/school_p_form} 
	\caption{app/views/home/school\_class\_new.html.haml}
	\label{fig:school_p_form}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/school_s_form} 
	\caption{app/views/home/school\_class\_new.html.haml}
	\label{fig:school_s_form}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/school_t_form} 
	\caption{app/views/home/school\_class\_new.html.haml}
	\label{fig:school_t_form}
\end{figure}

In tutti e tre i casi, una volta compilati gli ultimi campi e premuto il bottone \textbf{Completa la registrazione}, l'utente risulta registrato e verrà reindirizzato alla sua dashboard. Anch'essa è differente a seconda dei ruoli, ed è ottenuta combinanto diverse partial (\textit{app/views/dashboard/\_common.html.ham} e \textit{app/views/dashboard/\_posts.html.haml}) in diversi file. Nella figura \ref{fig:p_dashboard} è mostrata quella per il Genitore, nella \ref{fig:s_dashboard} quella per lo Studente e nella \ref{fig:t_dashboard} quella per l'Insegnante.\\
Si noti come in tutte le dashboard sono presenti i dati fondamentali dell'utente, il calendario (dove è segnato in verde acceso il giorno corrente e in giallo le scadenze delle comunicazioni) e i post relativi alla classe di interesse. In tutte è inoltre presente il bottone \textbf{Logout} per tornare alla pagina iniziale e terminare la sessione.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/p_dashboard} 
	\caption{app/views/dashboard/parent\_dashboard.html.haml}
	\label{fig:p_dashboard}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/s_dashboard} 
	\caption{app/views/dashboard/student\_dashboard.html.haml}
	\label{fig:s_dashboard}
\end{figure}

Nella pagina della Studente è presente anche il bottone \textbf{Materie}. Cliccandolo si potrà accedere ad un'altra schermata dove verranno visualizzati i link alle pagine corrispondenti alle materie insegnate dai professori registrati. (Figura \ref{fig:materie_page}).

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/materie_page} 
	\caption{app/views/subjects/index.html.haml}
	\label{fig:materie_page}
\end{figure}

Se si clicca sul bottone \textbf{Dashboard} si ritorna nell'omonima pagina, mentre se si segue uno dei link riguardanti le materie, per esempio \textit{Italiano}, ci si ritrova alla pagina dedicata, mostrata in figura \ref{fig:materia_page}. In essa si potrà trovare il materiale presente su Google Drive ed i post riguardanti solo quella specifica disciplina.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/materia_page} 
	\caption{app/views/subjects/show.html.haml}
	\label{fig:materia_page}
\end{figure}

Cliccando sul bottone \textbf{Materie} si ritorna alla pagina in figura \ref{fig:materie_page}.\\

Nella dashboard dell'Insegnante è presente, sulla sinistra, anche il materiale caricato su Google Drive per gli studenti, con i relativi link per la cancellazione ed il download. In basso a destra invece vi è la form per farne l'upload. 
Seguendo inoltre il bottone \textbf{Nuovo Post} si avrà a disposizione la pagina con la form che permetterà pubblicare, per l'appunto, un nuovo post. (Figura \ref{fig:nuovo_post}).\\

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/t_dashboard} 
	\caption{app/views/dashboard/teacher\_dashboard.html.haml}
	\label{fig:t_dashboard}
\end{figure}

Cliccando il tasto \textbf{Pubblica}, previa adeguata compilazione dei campi, verrà creata e pubblicata la comunicazione, e si sarà reindirizzati alla dashboard.\\

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/new_post} 
	\caption{app/views/posts/new.html.haml}
	\label{fig:nuovo_post}
\end{figure}

Infine, cliccando il bottone \textbf{Login} dalla pagina iniziale (figura \ref{fig:home_page}) si andrà a finire nell'omonima pagina (figura \ref{fig:login}). Si può scegliere se compilare i campi ed accedere con le credenziali locali (quelle impostate al momento della registrazione) oppure se accedere tramite Google sfruttando i servizi OAuht, venendo reindirizzati alla pagina corrispondente (figura \ref{fig:google_oauth}). 
A login effettuato ci si ritroverà sulla dashboard corrispondente al proprio ruolo.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/login} 
	\caption{app/views/users/sessions/new.html.haml}
	\label{fig:login}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{images/google_oauth} 
	\caption{Login con Google}
	\label{fig:google_oauth}
\end{figure}


\chapter{Dispiegamento e Validazione}

\section{Installazione}

Per installare l'applicazione è necessario posizionarsi nella directory di lavoro ed eseguire i seguenti comandi:
\begin{enumerate}
	\item \textit{git clone https://github.com/SilviadelPiano/HiSchool.git}
	\item \textit{bundle install}
	\item \textit{rake db:migrate}
\end{enumerate}

A questo punto perchè l'applicazione funzioni correttamente occorre registrare almeno una scuola e una classe, si apra quindi la console di Rails con il comando
\begin{itemize}
	\item \textit{rails console}
\end{itemize}

e si registrino i dati necessari utilizzando questa sintassi:
\begin{itemize}
	\item \textit{> School.create(name: "nome\_scuola")}
	\item \textit{> SchoolClass.create(name: "nome\_classe", school\_id: "id\_scuola (appena ritornato dalla console)")}
\end{itemize}

Se le transazioni sono andate a buon fine si può far partire l'applicazione con il seguente comando da terminale: 
\begin{itemize}
	\item \textit{rails server}
\end{itemize}

\section{Test} \label{test}

Da ultimo, si descriverà in breve la politica usata per effettuare i test.\\ 
Come spiegato nella sezione \ref{agile}, monitorare costantemente la correttezza dell'applicazione è stato fondamentale. Durante lo sviluppo è stata usata la gemma \textit{byebug}, uno strumento per il debugging interattivo. Per i test veri e propri si sono usati sopratutto Cucumber e Capybara con l'ausilio di Factory Bot (erede di Factory Girl). Factory Bot crea degli oggetti fantoccio da usare in questa fase, mentre Cucumber e Capybara si occupano di testare i vari scenari che rappresentano i comportamenti dell'utente. Tutti i file relativi sono contenuti nella cartella \textit{features}, dove sono particolarmente importanti i file contenuti nella cartella \textit{features/step\_definitions}, in quanto in essi è definito il modo in cui Cucumber dovrà interpretare i passi definiti nei file \textit{.feature}. Un altro componente fondamentale è il file \textit{features/support/paths.rb}, dove viene definita la traduzione dal linguaggio naturale alle routes dell'applicazione. I test per OAuth sono stati scritti nel file \textit{spec/google\_oauth\_spec.rb} poichè necessitava di uno stub (cioè una simulazione dell'oggetto) più elaborata.\\
Per far partire i test bisogna digitare i comandi 
\begin{itemize}
	\item \textit{bundle exec rake test\_with\_coveralls} per i test di Cucumber
	\item \textit{rspec} per i test con rspec
\end{itemize}

Sono stati effettuati anche test sulla sicuezza tramite la gemma \textit{brakeman}: essa simula vari tipi di attacchi sull'applicazione per controllare che sia sicura. Per farli partire basta digitare il comando 
\begin{itemize}
	\item \textit{brakeman}
\end{itemize}

Infine, per monitorare la versione e a relativa sicurezza di tutte le gemme si è usata \textit{gemsurance}, la quale genera un report apribile con il browser dove sono segnalate eventuali vulnerabilità. 

\backmatter
% bibliography
\cleardoublepage
\nocite{*}
\phantomsection
\bibliographystyle{sapthesis} % BibTeX style
\bibliography{biblio} % BibTeX database without .bib extension

\end{document}